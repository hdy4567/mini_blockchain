<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë‹ˆ ë¹„íŠ¸ì½”ì¸ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .block-card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s;
            /* ìœ„ë³€ì¡° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì»¤ì„œ ë³€ê²½ */
            cursor: pointer; 
        }
        .block-card:hover {
            transform: translateY(-2px);
        }
        .arrow {
            position: relative;
            margin-top: -1.5rem; /* ë¸”ë¡ ì¹´ë“œ ì‚¬ì´ì— ìœ„ì¹˜í•˜ë„ë¡ ì¡°ì • */
            z-index: 10;
        }
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1; /* slate-300 */
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: #f1f5f9; /* slate-100 */
        }
    </style>
    <!-- SHA256 Library for Hashing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-extrabold text-blue-800 mb-2">â‚¿ ë¯¸ë‹ˆ ë¹„íŠ¸ì½”ì¸ ì‹œë®¬ë ˆì´í„°</h1>
        <p class="text-gray-600 mb-8">ê±°ë˜ ìƒì„±, ì±„êµ´ì„ í†µí•œ ë¸”ë¡ì²´ì¸ ì—°ê²° ë° ì”ê³  ë³€í™”ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>

        <!-- ì”ê³  ë° ì±„êµ´ ì •ë³´ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div id="balance-alice" class="p-5 bg-white rounded-xl shadow-lg border-l-4 border-yellow-500">
                <p class="text-sm font-semibold text-gray-500">ì•¨ë¦¬ìŠ¤ (Alice)</p>
                <p class="text-2xl font-bold text-gray-800 mt-1">ì”ê³ : <span class="text-yellow-600">0.00 BTC</span></p>
            </div>
            <div id="balance-bob" class="p-5 bg-white rounded-xl shadow-lg border-l-4 border-yellow-500">
                <p class="text-sm font-semibold text-gray-500">ë°¥ (Bob)</p>
                <p class="text-2xl font-bold text-gray-800 mt-1">ì”ê³ : <span class="text-yellow-600">0.00 BTC</span></p>
            </div>
            <!-- ì±„êµ´ ë³´ìƒ ë° ë‹¤ìŒ ì±„êµ´ì í‘œì‹œ -->
            <div class="p-5 bg-white rounded-xl shadow-lg border-l-4 border-blue-500">
                <p class="text-sm font-semibold text-gray-500">ë‹¤ìŒ ì±„êµ´ì & ë³´ìƒ</p>
                <p class="text-2xl font-bold text-gray-800 mt-1">
                    <span id="current-miner-name" class="text-blue-600">Bob</span>
                    <span class="text-lg text-gray-500 font-normal"> (+<span id="mining-reward-display">10</span> BTC)</span>
                </p>
            </div>
        </div>

        <!-- ê±°ë˜ ìƒì„± ë° ì±„êµ´ ì˜ì—­ -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">ê±°ë˜ & ì±„êµ´</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ê±°ë˜ ìƒì„± -->
                <div class="p-4 border border-gray-200 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700">ìƒˆ ê±°ë˜ ìƒì„±</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ë³´ë‚´ëŠ” ì‚¬ëŒ (From)</label>
                            <select id="tx-from" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                <option value="Alice">Alice</option>
                                <option value="Bob">Bob</option>
                                <option value="Initial_Wallet">Initial_Wallet (ì”ê³  í™•ì¸ìš©)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ë°›ëŠ” ì‚¬ëŒ (To)</label>
                            <select id="tx-to" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                <option value="Bob">Bob</option>
                                <option value="Alice">Alice</option>
                                <option value="New_User">New_User (ì‹ ê·œ ì§€ê°‘)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ê¸ˆì•¡ (Amount)</label>
                            <input type="number" id="tx-amount" value="5" min="0.01" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <button onclick="addTransaction()" class="w-full py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none transition duration-150 ease-in-out">
                            ê±°ë˜ ì¶”ê°€ (ë©”ëª¨ë¦¬ í’€ë¡œ)
                        </button>
                    </div>
                </div>

                <!-- ë©”ëª¨ë¦¬ í’€ ë° ì±„êµ´ -->
                <div class="p-4 border border-gray-200 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3 text-gray-700">ë©”ëª¨ë¦¬ í’€ & ì±„êµ´</h3>
                    <div class="h-32 p-3 mb-3 bg-gray-50 rounded-lg overflow-y-auto border border-dashed border-gray-300">
                        <p class="text-sm text-gray-500 font-medium mb-1">ëŒ€ê¸° ì¤‘ì¸ ê±°ë˜ (Pending Transactions):</p>
                        <ul id="mempool-list" class="text-xs space-y-1">
                            <!-- Transactions will be listed here -->
                        </ul>
                    </div>
                    <button onclick="mineNewBlock()" id="mine-button" class="w-full py-3 px-4 rounded-lg shadow-md text-base font-bold text-white bg-red-600 hover:bg-red-700 focus:outline-none transition duration-150 ease-in-out">
                        ğŸ”¨ ìƒˆ ë¸”ë¡ ì±„êµ´ ì‹œì‘ (PoW)
                    </button>
                    <p id="mining-status" class="mt-2 text-center text-sm text-red-500 font-semibold hidden">ì±„êµ´ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
                </div>
            </div>
        </div>

        <!-- ë¸”ë¡ì²´ì¸ ì‹œê°í™” ì˜ì—­ -->
        <div class="bg-gray-100 p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">ë¸”ë¡ì²´ì¸ (Chain)</h2>
            <div id="blockchain-container" class="flex flex-wrap md:flex-nowrap gap-6 p-4 overflow-x-auto custom-scrollbar">
                <!-- Blocks will be rendered here -->
            </div>
            <div class="mt-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg hidden" id="validity-warning">
                <p class="font-bold">âš ï¸ ì²´ì¸ ìœ íš¨ì„± ê²½ê³ :</p>
                <p class="text-sm">í˜„ì¬ ë¸”ë¡ì²´ì¸ì˜ ë¬´ê²°ì„±ì´ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤. ì—°ê²°ëœ í•´ì‹œë¥¼ í™•ì¸í•˜ì„¸ìš”! (ë°ì´í„°ë¥¼ ë³µì›í•˜ê±°ë‚˜ ì´í›„ ë¸”ë¡ì„ ë‹¤ì‹œ ì±„êµ´í•´ì•¼ í•©ë‹ˆë‹¤.)</p>
            </div>
        </div>

    </div>

    <script>
        // ìƒìˆ˜ ì •ì˜ (ë¹„íŠ¸ì½”ì¸ ì—°ê´€)
        const DIFFICULTY = 4; // PoW ë‚œì´ë„: ì„ í–‰ '0'ì˜ ê°œìˆ˜
        const MINING_REWARD = 10; // ì±„êµ´ ì„±ê³µ ì‹œ ë°›ëŠ” ë³´ìƒ

        // ----------------------------------------------------
        // 1. Transaction Class
        // ----------------------------------------------------
        class Transaction {
            constructor(fromAddress, toAddress, amount) {
                this.fromAddress = fromAddress;
                this.toAddress = toAddress;
                this.amount = parseFloat(amount);
            }
        }

        // ----------------------------------------------------
        // 2. Block Class
        // ----------------------------------------------------
        class Block {
            constructor(index, timestamp, transactions, previousHash = '') {
                this.index = index;
                this.timestamp = timestamp;
                this.transactions = transactions;
                this.previousHash = previousHash;
                this.nonce = 0;
                this.hash = this.calculateHash();
            }

            calculateHash() {
                // ê±°ë˜ ëª©ë¡ì€ ê°ì²´ ì°¸ì¡°ê°€ ì•„ë‹Œ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ í•´ì‹œì˜ ë¶ˆë³€ì„±ì„ ë³´ì¥
                const txString = JSON.stringify(this.transactions.map(tx => ({
                    from: tx.fromAddress, 
                    to: tx.toAddress, 
                    amount: tx.amount
                })), null, 2);

                const blockString = JSON.stringify({
                    index: this.index,
                    timestamp: this.timestamp,
                    transactions: txString, // ê±°ë˜ ëª©ë¡ì„ ë¬¸ìì—´ë¡œ í¬í•¨
                    previousHash: this.previousHash,
                    nonce: this.nonce
                }, null, 2);
                
                // js-sha256 ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ì‹œ ê³„ì‚°
                return sha256.hex(blockString);
            }

            mineBlock(difficulty) {
                const targetPrefix = "0".repeat(difficulty);
                
                while (this.hash.substring(0, difficulty) !== targetPrefix) {
                    this.nonce++;
                    this.hash = this.calculateHash();
                }
                console.log(`Block ${this.index} Mined! Hash: ${this.hash}`);
            }
        }

        // ----------------------------------------------------
        // 3. Blockchain Class
        // ----------------------------------------------------
        class Blockchain {
            constructor() {
                this.chain = [];
                this.pendingTransactions = []; // ë©”ëª¨ë¦¬ í’€ (Mempool)
                this.difficulty = DIFFICULTY;
                this.miningReward = MINING_REWARD;
                this.createGenesisBlock();
            }

            createGenesisBlock() {
                // ì´ˆê¸° ì§€ê°‘ì— 100 BTCë¥¼ ë°œí–‰í•˜ëŠ” ì´ˆê¸° ê±°ë˜ë¥¼ í¬í•¨
                const genesisBlock = new Block(0, Date.now(), [new Transaction('Genesis', 'Initial_Wallet', 100)], "0");
                // ì œë„¤ì‹œìŠ¤ ë¸”ë¡ì€ ì±„êµ´ ì—†ì´ ì¦‰ì‹œ ì¶”ê°€
                genesisBlock.hash = genesisBlock.calculateHash(); 
                this.chain.push(genesisBlock);
            }

            getLatestBlock() {
                return this.chain[this.chain.length - 1];
            }

            minePendingTransactions(miningRewardAddress) {
                if (this.pendingTransactions.length === 0) {
                    // ê±°ë˜ê°€ ì—†ì„ ê²½ìš° PoWë¥¼ ìˆ˜í–‰í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ì±„êµ´ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.
                    // ë‹¤ë§Œ, ë¹„íŠ¸ì½”ì¸ ë„¤íŠ¸ì›Œí¬ì—ì„œëŠ” ë¹ˆ ë¸”ë¡ë„ ì±„êµ´ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´ ê²½ê³ ë¥¼ ë„ì›ë‹ˆë‹¤.
                    alert("ê²½ê³ : ëŒ€ê¸° ì¤‘ì¸ ê±°ë˜ê°€ ì—†ìŠµë‹ˆë‹¤. ì±„êµ´í•  ë¸”ë¡ì— í¬í•¨í•  ë‚´ìš©ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.");
                    return false;
                }

                // 1. ì±„êµ´ ë³´ìƒ ê±°ë˜ ìƒì„± (ë¹„íŠ¸ì½”ì¸ì˜ ì½”ì¸ë² ì´ìŠ¤ ê±°ë˜ ê°œë…)
                const rewardTx = new Transaction('Mining_Reward', miningRewardAddress, this.miningReward);
                // ì±„êµ´ ë³´ìƒì€ í˜„ì¬ ë¸”ë¡ì˜ ì²« ë²ˆì§¸ ê±°ë˜ë¡œ í¬í•¨ë©ë‹ˆë‹¤.
                const blockTransactions = [rewardTx, ...this.pendingTransactions];

                // 2. ìƒˆ ë¸”ë¡ ìƒì„±
                const newBlock = new Block(
                    this.chain.length, 
                    Date.now(), 
                    blockTransactions, 
                    this.getLatestBlock().hash
                );

                // 3. PoW ì±„êµ´ ì‹œì‘
                newBlock.mineBlock(this.difficulty);

                // 4. ë¸”ë¡ì²´ì¸ì— ì¶”ê°€ ë° ë©”ëª¨ë¦¬ í’€ ë¹„ìš°ê¸°
                this.chain.push(newBlock);
                this.pendingTransactions = [];
                return true;
            }

            getBalanceOfAddress(address) {
                let balance = 0;

                for (const block of this.chain) {
                    for (const tx of block.transactions) {
                        // ë³´ë‚´ëŠ” ì‚¬ëŒ: ì”ê³  ì°¨ê° (Genesis, Mining_Reward ì œì™¸)
                        if (tx.fromAddress !== null && tx.fromAddress !== 'Mining_Reward' && tx.fromAddress === address) {
                            balance -= tx.amount;
                        }

                        // ë°›ëŠ” ì‚¬ëŒ: ì”ê³  ì¶”ê°€
                        if (tx.toAddress === address) {
                            balance += tx.amount;
                        }
                    }
                }
                return balance;
            }

            isChainValid() {
                for (let i = 1; i < this.chain.length; i++) {
                    const currentBlock = this.chain[i];
                    const previousBlock = this.chain[i - 1];

                    // 1. í˜„ì¬ ë¸”ë¡ì˜ í•´ì‹œê°€ ì˜¬ë°”ë¥´ê²Œ ê³„ì‚°ë˜ì—ˆëŠ”ì§€ í™•ì¸ (PoW ì¡°ê±´ í¬í•¨)
                    if (currentBlock.hash !== currentBlock.calculateHash()) {
                        console.error(`Hash mismatch at Block #${i}. Stored Hash: ${currentBlock.hash}, Calculated Hash: ${currentBlock.calculateHash()}`);
                        return false;
                    }

                    // 2. ì´ì „ ë¸”ë¡ê³¼ì˜ ì—°ê²°ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
                    if (currentBlock.previousHash !== previousBlock.hash) {
                        console.error(`Link broken at Block #${i}. PreviousHash mismatch. Expected: ${previousBlock.hash}, Found: ${currentBlock.previousHash}`);
                        return false;
                    }
                }
                return true;
            }
        }

        // ----------------------------------------------------
        // 4. UI & Logic Integration
        // ----------------------------------------------------
        
        let miniCoin = new Blockchain();
        let currentMiner = 'Bob'; // ì±„êµ´ ë³´ìƒì„ ë°›ì„ ì£¼ì†Œ (Aliceì™€ Bobì´ êµëŒ€ë¡œ ì±„êµ´)

        const elements = {
            container: document.getElementById('blockchain-container'),
            mempool: document.getElementById('mempool-list'),
            balanceAlice: document.querySelector('#balance-alice span'),
            balanceBob: document.querySelector('#balance-bob span'),
            mineButton: document.getElementById('mine-button'),
            miningStatus: document.getElementById('mining-status'),
            validityWarning: document.getElementById('validity-warning'),
            currentMinerName: document.getElementById('current-miner-name'),
            miningRewardDisplay: document.getElementById('mining-reward-display'),
        };

        function updateUI() {
            renderBlockchain();
            renderMempool();
            updateBalances();
            checkValidity();
            updateMinerDisplay();
        }

        function updateBalances() {
            const aliceBalance = miniCoin.getBalanceOfAddress('Alice').toFixed(2);
            const bobBalance = miniCoin.getBalanceOfAddress('Bob').toFixed(2);
            
            elements.balanceAlice.textContent = `${aliceBalance} BTC`;
            elements.balanceBob.textContent = `${bobBalance} BTC`;
        }
        
        function updateMinerDisplay() {
            elements.currentMinerName.textContent = currentMiner;
            elements.miningRewardDisplay.textContent = MINING_REWARD;
        }

        function checkValidity() {
            const isValid = miniCoin.isChainValid();
            if (!isValid) {
                elements.validityWarning.classList.remove('hidden');
                elements.validityWarning.classList.remove('bg-red-100');
                elements.validityWarning.classList.add('bg-yellow-200', 'border-yellow-400');
                elements.validityWarning.querySelector('p').textContent = "âš ï¸ ì²´ì¸ ìœ íš¨ì„± ê²½ê³ : í˜„ì¬ ë¸”ë¡ì²´ì¸ì˜ í•´ì‹œ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ë³€ì¡°ëœ ë¸”ë¡ì˜ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì´í›„ ë¸”ë¡ë“¤ì„ ë‹¤ì‹œ ì±„êµ´í•´ì•¼ í•©ë‹ˆë‹¤.";
            } else {
                elements.validityWarning.classList.add('hidden');
            }
        }

        function renderMempool() {
            elements.mempool.innerHTML = '';
            if (miniCoin.pendingTransactions.length === 0) {
                elements.mempool.innerHTML = '<li class="text-gray-400">ëŒ€ê¸° ì¤‘ì¸ ê±°ë˜ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                elements.mineButton.disabled = true;
                elements.mineButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                miniCoin.pendingTransactions.forEach((tx, index) => {
                    const li = document.createElement('li');
                    li.className = 'text-gray-600';
                    li.textContent = `[${index + 1}] ${tx.fromAddress} â¡ï¸ ${tx.toAddress} (${tx.amount.toFixed(2)} BTC)`;
                    elements.mempool.appendChild(li);
                });
                elements.mineButton.disabled = false;
                elements.mineButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function renderBlockchain() {
            elements.container.innerHTML = '';
            
            miniCoin.chain.forEach((block, index) => {
                const blockHtml = renderBlockCard(block);
                elements.container.appendChild(blockHtml);
                
                // í™”ì‚´í‘œ ì¶”ê°€ (ë§ˆì§€ë§‰ ë¸”ë¡ ì œì™¸)
                if (index < miniCoin.chain.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.className = 'arrow w-16 h-4 flex items-center justify-center relative text-gray-400 hidden md:flex';
                    arrow.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>`;
                    elements.container.appendChild(arrow);
                }
            });
        }
        
        function renderBlockCard(block) {
            const card = document.createElement('div');
            card.className = 'block-card min-w-[300px] bg-white border-2 border-gray-200 rounded-xl p-5 flex-shrink-0';
            
            const transactionsList = block.transactions.map(tx => {
                const isReward = tx.fromAddress === 'Mining_Reward';
                const color = isReward ? 'text-blue-500 font-semibold' : 'text-gray-700';
                
                let txDesc = '';
                if (isReward) {
                    txDesc = `<span class="text-xs text-blue-400">[ì±„êµ´ ë³´ìƒ]</span> ${tx.toAddress} +${tx.amount.toFixed(2)} BTC`;
                } else {
                    txDesc = `${tx.fromAddress} â¡ï¸ ${tx.toAddress} ${tx.amount.toFixed(2)} BTC`;
                }
                
                return `<li class="${color} text-sm">${txDesc}</li>`;
            }).join('');
            
            // í˜„ì¬ í•´ì‹œì™€ ì´ì „ í•´ì‹œì˜ ì—°ê²° ë° PoW ìœ íš¨ì„± ê²€ì‚¬
            const previousBlock = block.index > 0 ? miniCoin.chain[block.index - 1] : null;
            const isPreviousHashCorrect = block.index === 0 || block.previousHash === previousBlock.hash;
            const previousHashColor = isPreviousHashCorrect ? 'text-gray-600' : 'text-red-500 font-bold';
            
            const isValidPoW = block.hash.startsWith('0'.repeat(DIFFICULTY));
            const currentHashColor = isValidPoW ? 'text-green-600 font-bold' : 'text-red-500 font-bold';
            
            const leadingZeros = block.hash.substring(0, DIFFICULTY);
            const remainingHash = block.hash.substring(DIFFICULTY);

            card.innerHTML = `
                <div class="flex justify-between items-center mb-3 border-b pb-2">
                    <span class="text-xl font-extrabold text-blue-900">BLOCK #${block.index}</span>
                    <span class="text-xs text-gray-500">${new Date(block.timestamp).toLocaleTimeString()}</span>
                </div>
                
                <p class="text-sm font-semibold mb-1">ì´ì „ í•´ì‹œ (Previous Hash):</p>
                <code class="${previousHashColor} text-xs break-all">${block.previousHash.substring(0, 10)}...</code>
                
                <p class="text-sm font-semibold mt-3 mb-1">í˜„ì¬ í•´ì‹œ (Current Hash):</p>
                <code class="${currentHashColor} text-xs break-all">
                    <span class="text-red-500">${leadingZeros}</span>${remainingHash}
                </code>
                
                <p class="text-sm font-semibold mt-3">Nonce: <span class="text-gray-800">${block.nonce}</span></p>
                
                <div class="mt-4 pt-3 border-t">
                    <p class="text-sm font-semibold mb-2">ê±°ë˜ ëª©ë¡ (${block.transactions.length}ê±´):</p>
                    <ul class="space-y-1">${transactionsList}</ul>
                </div>
            `;
            
            // --- ìœ„ë³€ì¡° ì‹œë®¬ë ˆì´ì…˜ ê¸°ëŠ¥ ---
            card.onclick = () => {
                if(block.index === 0) {
                    alert("ê²½ê³ : ì œë„¤ì‹œìŠ¤ ë¸”ë¡ì€ ë³€ì¡°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                
                // ë°ì´í„° ìœ„ë³€ì¡° ì‹œë„ (ì„ì˜ì˜ ë”ë¯¸ ê±°ë˜ ì¶”ê°€)
                const maliciousTx = new Transaction('Hacker', 'Alice', 0.0001);
                // ê¸°ì¡´ ê±°ë˜ ë°°ì—´ì˜ ë³µì‚¬ë³¸ì„ ë§Œë“¤ì–´ ì„ì˜ì˜ ìœ„ì¹˜ì— ì‚½ì… (ë°ì´í„° ë³€ê²½ ìœ ë„)
                const newTransactions = [...block.transactions];
                newTransactions.push(maliciousTx); 
                
                // Block ê°ì²´ì˜ ê±°ë˜ ëª©ë¡ì„ ê°•ì œë¡œ ë³€ê²½
                block.transactions = newTransactions;
                
                const newHash = block.calculateHash();
                
                // í•´ì‹œê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                if (block.hash !== newHash) {
                    alert(`ğŸš¨ BLOCK #${block.index}ì˜ ë°ì´í„°ê°€ ë³€ì¡°ë˜ì—ˆìŠµë‹ˆë‹¤! í•´ì‹œê°€ ë³€ê²½ë©ë‹ˆë‹¤.`);
                    // 1. í•´ë‹¹ ë¸”ë¡ì˜ í•´ì‹œë¥¼ ë³€ì¡°ëœ ë°ì´í„° ê¸°ë°˜ì˜ í•´ì‹œë¡œ ê°•ì œ ì—…ë°ì´íŠ¸
                    block.hash = newHash; 
                    // 2. ì´í›„ì˜ ëª¨ë“  ë¸”ë¡ì˜ ì—°ê²°ì´ ëŠì–´ì§€ê²Œ ë˜ë¯€ë¡œ UI ì „ì²´ ì—…ë°ì´íŠ¸
                    updateUI();
                }
            };
            
            return card;
        }

        // --- ì‚¬ìš©ì ì•¡ì…˜ í•¨ìˆ˜ ---

        function addTransaction() {
            const from = document.getElementById('tx-from').value;
            const to = document.getElementById('tx-to').value;
            const amount = parseFloat(document.getElementById('tx-amount').value);
            
            if (from === to) {
                alert("ê²½ê³ : ë³´ë‚´ëŠ” ì‚¬ëŒê³¼ ë°›ëŠ” ì‚¬ëŒì€ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }
            if (isNaN(amount) || amount <= 0) {
                alert("ê²½ê³ : ìœ íš¨í•œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }
            
            const balance = miniCoin.getBalanceOfAddress(from);
            // ì œë„¤ì‹œìŠ¤ ë¸”ë¡ì—ì„œ ì½”ì¸ì„ ë°›ì€ 'Initial_Wallet'ì€ ì”ê³ ê°€ ë„‰ë„‰í•˜ë‹¤ê³  ê°€ì •í•˜ê³ , Alice/Bob/New_Userë§Œ ì”ê³  ì²´í¬
            if (from !== 'Initial_Wallet' && balance < amount) {
                alert(`ê²½ê³ : ${from}ì˜ ì”ê³ (${balance.toFixed(2)} BTC)ê°€ ë¶€ì¡±í•˜ì—¬ ê±°ë˜ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }

            const newTx = new Transaction(from, to, amount);
            miniCoin.pendingTransactions.push(newTx);
            
            console.log(`ìƒˆ ê±°ë˜ ì¶”ê°€: ${from} -> ${to}, ${amount} BTC`);
            updateUI();
        }

        async function mineNewBlock() {
            elements.mineButton.disabled = true;
            elements.miningStatus.classList.remove('hidden');
            elements.mineButton.classList.add('animate-pulse');
            
            // UI ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë¹„ë™ê¸° ì²˜ë¦¬
            await new Promise(resolve => setTimeout(resolve, 10)); 

            const success = miniCoin.minePendingTransactions(currentMiner);
            
            elements.mineButton.disabled = false;
            elements.miningStatus.classList.add('hidden');
            elements.mineButton.classList.remove('animate-pulse');


            if (success) {
                console.log(`ìƒˆ ë¸”ë¡ #${miniCoin.getLatestBlock().index} ì±„êµ´ ì„±ê³µ!`);
                updateUI();
                // ì±„êµ´ì ì „í™˜ (Bob <-> Alice)
                currentMiner = (currentMiner === 'Bob') ? 'Alice' : 'Bob';
            }
        }
        
        // ì´ˆê¸° UI ë Œë”ë§
        window.onload = () => {
            // ì´ˆê¸° ì‹œë“œë¥¼ ìœ„í•´ Initial_Walletì˜ ì”ê³  ì¤‘ ì¼ë¶€ë¥¼ Aliceì™€ Bobì—ê²Œ ë¯¸ë¦¬ ì „ì†¡í•©ë‹ˆë‹¤.
            // (ì´ ê±°ë˜ë“¤ì€ ë©”ëª¨ë¦¬ í’€ì— ì¶”ê°€ë˜ì§€ ì•Šê³ , ì²´ì¸ ì™¸ì ì¸ ì´ˆê¸° ì„¸íŒ…ìœ¼ë¡œ ê°„ì£¼)
            const initialSeedTx = (from, to, amount) => {
                miniCoin.chain[0].transactions.push(new Transaction(from, to, amount));
            };
            initialSeedTx('Initial_Wallet', 'Alice', 20);
            initialSeedTx('Initial_Wallet', 'Bob', 20);

            updateUI();
        };

    </script>
</body>
</html>